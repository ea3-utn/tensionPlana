##-----UTN FACULTAD REGIONAL HAEDO----------------* - Octave - *-----------------------------
##     _________    ____________  |    
##    / ____/   |  /  _/  _/  _/  |    CATEDRA ESTRUCTURAS AERONAUTICAS III
##   / __/ / /| |  / / / / / /    |
##  / /___/ ___ |_/ /_/ /_/ /     |    ELEMENTOS BIDIMENSIONALES (Tensi√≥n plana)
## /_____/_/  |_/___/___/___/     |
##                                |    quad4Lagrange: Caracterizacion del elemento de lagrange
##                                |                     
##---------CICLO LECTIVO 2021----------------------------------------------------------------

function [KG,fq]=quad4Lagrange(ABSCISAS,ORDENADAS,t,distribuidaX,distribuidaY)

  syms x y b h nu E

  BTDB=[(t*((3*E*((1/b)*(1/h))*b^(3)*h^(2)-2*E*b^(2)*h)*nu-6*E*((1/b)*(1/h))*b*h^(4)+4*E*h^(3)-3*E*((1/b)*(1/h))*b^(3)*h^(2)+2*E*b^(2)*h))/(b*(6*((1/b)*(1/h))*b*h^(3)*nu^(2)-6*((1/b)*(1/h))*b*h^(3))) 	-(0.5*(4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-4*E*((1/b)*(1/h))*b*h+E)*t)/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu-4*((1/b)*(1/h))*b*h^(2))) 	(t*(E*b^(2)*h*nu+12*E*((1/b)*(1/h))*b*h^(4)-8*E*h^(3)-E*b^(2)*h))/(b*(12*((1/b)*(1/h))*b*h^(3)*nu^(2)-12*((1/b)*(1/h))*b*h^(3))) 	-(0.5*t*((4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-E)*nu-4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)+4*E*((1/b)*(1/h))*b*h-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(t*((3*E*((1/b)*(1/h))*b^(3)*h^(2)-2*E*b^(2)*h)*nu+E*h^(3)-3*E*((1/b)*(1/h))*b^(3)*h^(2)+2*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	(0.5*t*((8*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-6*E*((1/b)*(1/h))*b*h+E)*nu-2*E*((1/b)*(1/h))*b*h+E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(t*(E*b^(2)*h*nu-2*E*h^(3)-E*b^(2)*h))/(b^(2)*(12*((1/b)*(1/h))*h^(3)*nu^(2)-12*((1/b)*(1/h))*h^(3))) 	(0.5*t*((2*E*((1/b)*(1/h))*b*h-E)*nu+2*E*((1/b)*(1/h))*b*h-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2)));-(0.5*(4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-4*E*((1/b)*(1/h))*b*h+E)*t)/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu-4*((1/b)*(1/h))*b*h^(2))) 	(t*((3*E*((1/b)*(1/h))*b*h^(4)-2*E*h^(3))*nu-3*E*((1/b)*(1/h))*b*h^(4)+2*E*h^(3)-6*E*((1/b)*(1/h))*b^(3)*h^(2)+4*E*b^(2)*h))/(b*(6*((1/b)*(1/h))*b*h^(3)*nu^(2)-6*((1/b)*(1/h))*b*h^(3))) 	(0.5*t*((8*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-6*E*((1/b)*(1/h))*b*h+E)*nu-2*E*((1/b)*(1/h))*b*h+E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(t*((3*E*((1/b)*(1/h))*b*h^(4)-2*E*h^(3))*nu-3*E*((1/b)*(1/h))*b*h^(4)+2*E*h^(3)+E*b^(2)*h))/(b*(6*((1/b)*(1/h))*b*h^(3)*nu^(2)-6*((1/b)*(1/h))*b*h^(3))) 	-(0.5*t*((4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-E)*nu-4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)+4*E*((1/b)*(1/h))*b*h-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	(0.5*t*(E*h^(3)*nu-E*h^(3)+12*E*((1/b)*(1/h))*b^(3)*h^(2)-8*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	(0.5*t*((2*E*((1/b)*(1/h))*b*h-E)*nu+2*E*((1/b)*(1/h))*b*h-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(0.5*t*(E*h^(3)*nu-E*h^(3)-2*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3)));(t*(E*b^(2)*h*nu+12*E*((1/b)*(1/h))*b*h^(4)-8*E*h^(3)-E*b^(2)*h))/(b*(12*((1/b)*(1/h))*b*h^(3)*nu^(2)-12*((1/b)*(1/h))*b*h^(3))) 	(0.5*t*((8*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-6*E*((1/b)*(1/h))*b*h+E)*nu-2*E*((1/b)*(1/h))*b*h+E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	(t*(E*b^(2)*h*nu-6*E*((1/b)*(1/h))*b*h^(4)+4*E*h^(3)-E*b^(2)*h))/(b*(6*((1/b)*(1/h))*b*h^(3)*nu^(2)-6*((1/b)*(1/h))*b*h^(3))) 	(0.5*(2*E*((1/b)*(1/h))*b*h-E)*t)/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu-4*((1/b)*(1/h))*b*h^(2))) 	-(t*(E*b^(2)*h*nu-2*E*h^(3)-E*b^(2)*h))/(b^(2)*(12*((1/b)*(1/h))*h^(3)*nu^(2)-12*((1/b)*(1/h))*h^(3))) 	-(0.5*t*((8*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-8*E*((1/b)*(1/h))*b*h+E)*nu+E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(t*(E*b^(2)*h*nu+E*h^(3)-E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	-(0.5*t*((4*E*((1/b)*(1/h))*b*h-E)*nu-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2)));-(0.5*t*((4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-E)*nu-4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)+4*E*((1/b)*(1/h))*b*h-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(t*((3*E*((1/b)*(1/h))*b*h^(4)-2*E*h^(3))*nu-3*E*((1/b)*(1/h))*b*h^(4)+2*E*h^(3)+E*b^(2)*h))/(b*(6*((1/b)*(1/h))*b*h^(3)*nu^(2)-6*((1/b)*(1/h))*b*h^(3))) 	(0.5*(2*E*((1/b)*(1/h))*b*h-E)*t)/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu-4*((1/b)*(1/h))*b*h^(2))) 	(t*((3*E*((1/b)*(1/h))*b*h^(4)-2*E*h^(3))*nu-3*E*((1/b)*(1/h))*b*h^(4)+2*E*h^(3)-2*E*b^(2)*h))/(b*(6*((1/b)*(1/h))*b*h^(3)*nu^(2)-6*((1/b)*(1/h))*b*h^(3))) 	(0.5*t*((4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-4*E*((1/b)*(1/h))*b*h-E)*nu-4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)+4*E*((1/b)*(1/h))*b*h-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(0.5*t*(E*h^(3)*nu-E*h^(3)-2*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	(0.5*t*((2*E*((1/b)*(1/h))*b*h+E)*nu-2*E*((1/b)*(1/h))*b*h+E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	(0.5*t*(E*h^(3)*nu-E*h^(3)+4*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3)));-(t*((3*E*((1/b)*(1/h))*b^(3)*h^(2)-2*E*b^(2)*h)*nu+E*h^(3)-3*E*((1/b)*(1/h))*b^(3)*h^(2)+2*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	-(0.5*t*((4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-E)*nu-4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)+4*E*((1/b)*(1/h))*b*h-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(t*(E*b^(2)*h*nu-2*E*h^(3)-E*b^(2)*h))/(b^(2)*(12*((1/b)*(1/h))*h^(3)*nu^(2)-12*((1/b)*(1/h))*h^(3))) 	(0.5*t*((4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-4*E*((1/b)*(1/h))*b*h-E)*nu-4*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)+4*E*((1/b)*(1/h))*b*h-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	(t*((3*E*((1/b)*(1/h))*b^(3)*h^(2)-2*E*b^(2)*h)*nu-2*E*h^(3)-3*E*((1/b)*(1/h))*b^(3)*h^(2)+2*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	(0.5*(2*E*((1/b)*(1/h))*b*h-E)*t)/(((1/b)*(1/h))*b^(2)*(4*((1/b)*(1/h))*h^(2)*nu-4*((1/b)*(1/h))*h^(2))) 	(t*(E*b^(2)*h*nu+4*E*h^(3)-E*b^(2)*h))/(b^(2)*(12*((1/b)*(1/h))*h^(3)*nu^(2)-12*((1/b)*(1/h))*h^(3))) 	(0.5*t*((2*E*((1/b)*(1/h))*b*h+E)*nu-2*E*((1/b)*(1/h))*b*h+E))/(((1/b)*(1/h))*b^(2)*(4*((1/b)*(1/h))*h^(2)*nu^(2)-4*((1/b)*(1/h))*h^(2)));(0.5*t*((8*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-6*E*((1/b)*(1/h))*b*h+E)*nu-2*E*((1/b)*(1/h))*b*h+E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	(0.5*t*(E*h^(3)*nu-E*h^(3)+12*E*((1/b)*(1/h))*b^(3)*h^(2)-8*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	-(0.5*t*((8*E*((1/b)*(1/h))^(2)*b^(2)*h^(2)-8*E*((1/b)*(1/h))*b*h+E)*nu+E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(0.5*t*(E*h^(3)*nu-E*h^(3)-2*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	(0.5*(2*E*((1/b)*(1/h))*b*h-E)*t)/(((1/b)*(1/h))*b^(2)*(4*((1/b)*(1/h))*h^(2)*nu-4*((1/b)*(1/h))*h^(2))) 	(t*(E*h^(3)*nu-E*h^(3)-6*E*((1/b)*(1/h))*b^(3)*h^(2)+4*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	-(0.5*t*((4*E*((1/b)*(1/h))*b*h-E)*nu-E))/(((1/b)*(1/h))*b^(2)*(4*((1/b)*(1/h))*h^(2)*nu^(2)-4*((1/b)*(1/h))*h^(2))) 	-(t*(E*h^(3)*nu-E*h^(3)+E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3)));-(t*(E*b^(2)*h*nu-2*E*h^(3)-E*b^(2)*h))/(b^(2)*(12*((1/b)*(1/h))*h^(3)*nu^(2)-12*((1/b)*(1/h))*h^(3))) 	(0.5*t*((2*E*((1/b)*(1/h))*b*h-E)*nu+2*E*((1/b)*(1/h))*b*h-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(t*(E*b^(2)*h*nu+E*h^(3)-E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	(0.5*t*((2*E*((1/b)*(1/h))*b*h+E)*nu-2*E*((1/b)*(1/h))*b*h+E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	(t*(E*b^(2)*h*nu+4*E*h^(3)-E*b^(2)*h))/(b^(2)*(12*((1/b)*(1/h))*h^(3)*nu^(2)-12*((1/b)*(1/h))*h^(3))) 	-(0.5*t*((4*E*((1/b)*(1/h))*b*h-E)*nu-E))/(((1/b)*(1/h))*b^(2)*(4*((1/b)*(1/h))*h^(2)*nu^(2)-4*((1/b)*(1/h))*h^(2))) 	(t*(E*b^(2)*h*nu-2*E*h^(3)-E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	-(0.5*E*t)/(((1/b)*(1/h))*b^(2)*(4*((1/b)*(1/h))*h^(2)*nu-4*((1/b)*(1/h))*h^(2)));(0.5*t*((2*E*((1/b)*(1/h))*b*h-E)*nu+2*E*((1/b)*(1/h))*b*h-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	-(0.5*t*(E*h^(3)*nu-E*h^(3)-2*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	-(0.5*t*((4*E*((1/b)*(1/h))*b*h-E)*nu-E))/(((1/b)*(1/h))*b*(4*((1/b)*(1/h))*b*h^(2)*nu^(2)-4*((1/b)*(1/h))*b*h^(2))) 	(0.5*t*(E*h^(3)*nu-E*h^(3)+4*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	(0.5*t*((2*E*((1/b)*(1/h))*b*h+E)*nu-2*E*((1/b)*(1/h))*b*h+E))/(((1/b)*(1/h))*b^(2)*(4*((1/b)*(1/h))*h^(2)*nu^(2)-4*((1/b)*(1/h))*h^(2))) 	-(t*(E*h^(3)*nu-E*h^(3)+E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3))) 	-(0.5*E*t)/(((1/b)*(1/h))*b^(2)*(4*((1/b)*(1/h))*h^(2)*nu-4*((1/b)*(1/h))*h^(2))) 	(t*(E*h^(3)*nu-E*h^(3)-2*E*b^(2)*h))/(b^(2)*(6*((1/b)*(1/h))*h^(3)*nu^(2)-6*((1/b)*(1/h))*h^(3)))];

  N=[(1-x/b)*(1-y/h) 0 (x/b)*(1-y/h) 0 (1-x/b)*(y/h) 0 (x/b)*(y/h) 0 ;0 (1-x/b)*(1-y/h) 0 (x/b)*(1-y/h)  0 (1-x/b)*(y/h) 0 (x/b)*(y/h)];

### ---- TODOS LOS ELEMENTOS TIENEN LA MISMA DIMENSION
  
  
  anchoElemento=(ABSCISAS(2)-ABSCISAS(1))/ABSCISAS(3);

  altoElemento=(ORDENADAS(2)-ORDENADAS(1))/ORDENADAS(3);

  elasticidad=ABSCISAS(4);

  poisson=ABSCISAS(5);

  MAX=ABSCISAS(3);
  
#### ---- MATRIZ DE RIGIDEZ LOCAL
  
  funcionalRigidez=function_handle(BTDB);

  k=funcionalRigidez(elasticidad,anchoElemento,altoElemento,poisson);			  

#### ---- PREPARACION MATRIZ DE RIGIDEZ GLOBAL

    
  GL=8+2*(MAX-1)*2+2*(ORDENADAS(3)-1)*2+(MAX-1)*(ORDENADAS(3)-1)*2; 

  KG=zeros(GL,GL);

  fqt=zeros(1,GL);
	   
#### ---- MATRIZ DE CONECTIVIDAD

  Mconectividad= @(u,v) [2*u-1+(v-1)*2*(MAX+1) 2*u+(v-1)*2*(MAX+1) 2*(u+1)-1+(v-1)*2*(MAX+1) 2*(u+1)+(v-1)*2*(MAX+1) 2*(MAX+u)+1+(v-1)*2*(MAX+1) 2*(MAX+u)+2+(v-1)*2*(MAX+1) 2*(MAX+u)+3+(v-1)*2*(MAX+1) 2*(MAX+u)+4+(v-1)*2*(MAX+1)];

### ----- POR ELEMENTO

  
  
  for v=1:ORDENADAS(3)

    for u=1:MAX

      conectividad=Mconectividad(u,v);

################ CARGAS DISTRIBUIDAS

      fqGlobalx=zeros(1,8);

      fqGlobaly=zeros(1,8);

      
	
      distriX=find(distribuidaX(:,1)==u & distribuidaX(:,2)==v);

      distriY=find(distribuidaY(:,1)==u & distribuidaY(:,2)==v);
     
      if (isempty(distriX)==0)
	
	fqGlobalx=double(-t*int(subs(transpose(N),{x,b,h},[distribuidaX(distriX,5),anchoElemento,altoElemento])*distribuidaX(distriX,6)*[1 0]',y,distribuidaX(distriX,3),distribuidaX(distriX,4))');

      endif

      if (isempty(distriY)==0)
	
	fqGlobaly=double(-t*int(subs(transpose(N),{y,b,h},[distribuidaY(distriY,5),anchoElemento,altoElemento])*distribuidaY(distriY,6)*[0 1]',x,distribuidaY(distriY,3),distribuidaY(distriY,4))');

      endif
      

######################################

      
      for i=1:8
	
	fqt(conectividad(i))=fqt(conectividad(i))+fqGlobaly(i);

	fqt(conectividad(i))=fqt(conectividad(i))+fqGlobalx(i);
	
	for j=1:8

	  try

	    KG(conectividad(i),conectividad(j))=KG(conectividad(i),conectividad(j))+k(i,j);
	    
	  catch

	    KG(conectividad(i),conectividad(j))=k(i,j);
	    
	  end_try_catch

	endfor
      endfor

    endfor
  endfor
  
  fq=fqt';
  
endfunction


